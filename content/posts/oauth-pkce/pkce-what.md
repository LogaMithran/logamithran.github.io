+++
date = '2025-04-28T20:52:02+05:30'
title = 'Unlocking PKCE: How Modern Apps Stay Secure Without Secrets'
+++

# What is PKCE?

##### PKCE - Proof key for code exchange

There are different OAuth grant types like

1. Authorization code
2. Authorization code with PKCE (recommended)
3. Client credentials
4. Implicit flow
5. Password grant
6. Device grant

All these grant types are used for authenticating users to your application via an Identity provider. Out of these, 1
and 2 are used in most of the web applications.

![pkce_diagram](/pkce_diagram.svg)

# Why should you care about?

With the Authorization Code grant, your client remains secure if it's a confidential (private) client. However, for
public clients, the client secret cannot be securely stored and exposing it can lead to security vulnerabilities

If you are having a single page application backed up by authorization code as your grant type then consider using PKCE
in your authentication flow

# How to use it?

1️⃣ User tries to log in to your application, and the application sees that the user needs to log in to view/scroll
Our application is using an external identity provider for user authentication, so it builds the redirect URL along with
**code_challenge**.In the url we need to specify the callback URL and the scopes that the application needs

```http request
client_id=<client_id>&code_challenge=<code_challenge>&code_challenge_method=<plain | S256>&redirect_uri=https://<host>/auth/callback&response_type=code&scope=openid
```

2️⃣ So, how can we build the code_challenge It’s just a random 128-bit string.

```shell
random_bytes = SecureRandom.random_bytes(32)
code_verifier = Base64.strict_encode64(random_bytes).tr('+/', '-_').delete('=')
code_challenge = Base64.strict_encode64(code_verifier)
```

3️⃣ Now, the application needs to redirect the user to the identity provider

```http request
https://<host>/protocol/openid-connect/auth?client_id=<client_id>&code_challenge=<code_challenge>&
    code_challenge_method=S256&prompt=consent&redirect_uri=https://<host>/admin/auth/keycloak/callback&
    response_type=code&scope=openid

```

4️⃣ Users will enter the credentials, and the identity provider will validate the credentials and redirect them to the
specified callback URL

5️⃣ & 6️⃣ Now the application needs to get the access-token and refresh_token using the authorization code provided
along with the code_verifier that has been generated by us. If code_verifier is attached in the payload we will get this
error
<pre> <code>invalid_grant :: PKCE code verifier not specified </code> </pre>


7️⃣ Once the IDP verifies the code_verifier then it returns the access_token | id_token and refresh_token

Using this application will access the identity provider for any access to the user
